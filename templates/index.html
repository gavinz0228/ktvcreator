<html>
<head>
    <title> Youtube KTV</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body class="container">
    <h1 class="mb-3 row">KTV Creator</h1>
    <div class="mb-3 row">
        <label for="ytUrl" class="col-sm-2 col-form-label">Youtube Url</label>
        <div class="col-sm-10">
            <input type="text" id="ytUrl" class="form-control" placeholder="Paste your youtube url here." size ="100"/> 
        </div>
    </div>
    
    <button class="form-control btn btn-primary" onclick="process()">Process</button>
    <div id="processing_message"> </div>
</body>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<script>
REQUEST_TIMEOUT = 600 * 1000;

function process(){

    var ytUrl = document.getElementById("ytUrl").value;
    if(!isUrlValid(ytUrl))
    {
        alert("Please paste/ type in a valid youtube video link!");
        return;
    }

    processingMsgDiv = document.getElementById("processing_message");
    processingMsgDiv.innerHTML = "Video is being processed in the backend";

    axios.get('/process?url='+ ytUrl, {timeout: REQUEST_TIMEOUT})
        .then((response) => {
            console.log(response);
            processingMsgDiv.innerHTML = "Processing done! " + generateLinks(response.data);
        }, (error) => {
            alert("Backend processing timed out. Please contact the author.");
            console.log(error);
        });
    
}

function isUrlValid(ytUrl){
    return ytUrl.trim() != "" && ytUrl.startsWith('https://', 0) || ytUrl.length >= 20;
}

function generateLinks(videoId){
    return '<a href="download/'+ videoId +'.mp4">Original Youtube Video</a> '
        + '<a href="download/'+ videoId +'.mp4.audio.mp4">Original Youtube Audio</a> '
        + '<a href="download/'+ videoId +'.mp4.audio_no_vocal.mp4">Vocal-removed Audio</a> '
        + '<a href="download/'+ videoId +'.mp4.final.mp4">Vocal-removed Video</a> '
        + '<video width="100%" height="100%" controls> <source src="download/'+ videoId +'.mp4.final.mp4" type="video/mp4"></video>';
}
</script>
</html>